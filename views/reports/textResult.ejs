<% layout('layouts/boilerplate') %>

<div class="container mt-5">
  <h3 class="mb-4">Your AI Medical Report Summary</h3>

  <!-- Summary box -->
  <div class="border p-3 bg-light rounded mb-4" id="summaryText">
    <%= report.summaryText %>
  </div>

  <!-- Action buttons row -->
  <div class="d-flex flex-wrap gap-2 align-items-center mb-4">

    <a href="/ai-report" class="btn btn-primary btn-lg">Upload Another</a>

     
    <a href="/ai-report/image/<%= report._id %>" class="btn btn-danger btn-lg"> Generate AI Image</a>

    <button id="ttsBtn" class="btn btn-success btn-lg"> Listen to Summary</button>

    <a href="/ai-report/video-result/<%= report._id %>" class="btn btn-warning btn-lg"> Watch Video</a>

   

    <select id="languageSelect" class="form-select w-auto">
      <option value="es">Spanish</option>
      <option value="fr">French</option>
      <option value="de">German</option>
      <option value="hi">Hindi</option>
      <option value="zh">Chinese</option>
      <option value="ar">Arabic</option>
    </select>
    <button id="translateBtn" class="btn btn-info btn-lg">Translate</button>
  </div>

  <!-- TTS audio player -->
  <div id="ttsPlayerContainer" style="display:none;">
    <audio id="ttsPlayer" controls class="w-100"></audio>
  </div>

  <!-- AI Image display (optional) -->
  <div id="aiImageContainer" class="mt-3"></div>
</div>

<script>
  const reportId = "<%= report._id %>";

  // TEXT-TO-SPEECH
  document.getElementById("ttsBtn").addEventListener("click", async () => {
    const res = await fetch(`/ai-report/tts/${reportId}`);
    if (res.ok) {
      const audioUrl = await res.text();
      const player = document.getElementById("ttsPlayer");
      player.src = audioUrl;
      document.getElementById("ttsPlayerContainer").style.display = "block";
      player.play();
    } else alert("Error generating speech");
  });

  // TRANSLATE
  document.getElementById("translateBtn").addEventListener("click", async () => {
    const lang = document.getElementById("languageSelect").value;
    const res = await fetch(`/ai-report/translate/${reportId}?lang=${lang}`);
    if (res.ok) {
      const data = await res.json();
      document.getElementById("summaryText").innerText = data.translatedText;
    } else alert("Error translating summary");
  });
</script>
